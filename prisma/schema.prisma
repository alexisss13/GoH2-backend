// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// Modelo para el registro de usuarios
model Usuario {
  id              String   @id @default(uuid())
  email           String   @unique
  nombre          String   
  passwordHash    String
  fechaNacimiento DateTime? 
  genero          String?   
  alturaCm        Int?      
  pesoKg          Float?    
  nivelActividad  String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  unidadMedida    UnidadMedida @default(ML)

  // Relaciones
  registros RegistroBebida[]
  objetivos ObjetivoHidratacion[]

  // Usuarios que yo estoy siguiendo (soy el 'seguidor')
  siguiendo Follow[] @relation("Seguidor")
  // Usuarios que me siguen a mí (soy el 'seguido')
  seguidores Follow[] @relation("Seguido")
}

// Modelo para los tipos de bebidas disponibles
model Bebida {
  id    String @id @default(uuid())
  nombre String @unique // "Agua", "Café", "Té", etc.
  
  // El factor para calcular el aporte hídrico real.
  // Basado en "100 ml de aporte hídrico" para "100 ml" de "Agua" 
  // Agua = 1.0, otras bebidas pueden tener factores diferentes.
  factorHidratacion Float    @default(1.0)
  
  // Relación
  registros         RegistroBebida[]
}

// Modelo para los registros de consumo de bebidas 
model RegistroBebida {
  id                  String       @id @default(uuid())
  cantidadConsumidaMl Int          // Ej: 100ml 
  aporteHidricoMl     Int          // Ej: 100ml  (Calculado: cantidadConsumidaMl * bebida.factorHidratacion)
  fechaHora           DateTime     @default(now()) // 
  tipoRegistro        TipoRegistro // "Manual" o "Digital" 

  // Relación con Usuario
  usuarioId String
  usuario Usuario @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  
  // Relación con Bebida
  bebidaId String
  bebida   Bebida @relation(fields: [bebidaId], references: [id])

  @@index([usuarioId, fechaHora])
}

// Modelo para el objetivo de hidratación diario 
model ObjetivoHidratacion {
  id         String   @id @default(uuid())
  fecha      DateTime @db.Date // El día específico del objetivo
  cantidadMl Int      // Ej: 1264 ml 

  // Relación con Usuario
  usuarioId String
  usuario Usuario @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@unique([usuarioId, fecha])
}

// Modelo para el sistema de "Seguir" (Twitter/Instagram style)
model Follow {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())

  // Quién sigue
  seguidorId String
  seguidor   Usuario  @relation("Seguidor", fields: [seguidorId], references: [id], onDelete: Cascade)

  // A quién sigue
  seguidoId String
  seguido   Usuario  @relation("Seguido", fields: [seguidoId], references: [id], onDelete: Cascade)

  // Índice único para asegurar que no se pueda seguir dos veces
  @@unique([seguidorId, seguidoId])
  @@index([seguidorId])
  @@index([seguidoId])
}

enum TipoRegistro {
  MANUAL
  DIGITAL
}

enum UnidadMedida {
  ML
  OZ
}